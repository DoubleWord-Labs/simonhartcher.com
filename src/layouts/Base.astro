---
import "../pico.violet.css";
import "../pico.colors.css";
import "../styles.css";
import NavBar from "@components/NavBar.astro";
import PostHog from "@components/posthog.astro";
import Turnstile from "@components/CloudFlareTurnstile.astro";

export interface Props {
    title: string;
    description?: string;
    image?: string;
    url?: string;
}

const { title, description = "Simon Hartcher's Blog", image, url } = Astro.props;
const siteTitle = "Simon Hartcher";
const fullTitle = title ? `${title} | ${siteTitle}` : siteTitle;
const siteUrl = "https://simonhartcher.com";
const canonicalUrl = url ? `${siteUrl}${url}` : siteUrl;
const ogImage = image ? (image.startsWith('http') ? image : `${siteUrl}${image}`) : undefined;
---

<script>
    import("altcha");
</script>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="color-scheme" content="light dark" />
        <meta name="description" content={description} />

        <!-- Open Graph -->
        <meta property="og:type" content="website" />
        <meta property="og:site_name" content={siteTitle} />
        <meta property="og:title" content={fullTitle} />
        <meta property="og:description" content={description} />
        <meta property="og:url" content={canonicalUrl} />
        {ogImage && <meta property="og:image" content={ogImage} />}
        {ogImage && <meta property="og:image:alt" content={title || "Cover image"} />}

        <!-- Twitter Card -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:site" content="@deevus" />
        <meta name="twitter:creator" content="@deevus" />
        <meta name="twitter:title" content={fullTitle} />
        <meta name="twitter:description" content={description} />
        {ogImage && <meta name="twitter:image" content={ogImage} />}

        <meta http-equiv="x-ua-compatible" content="ie=edge" />
        <link rel="canonical" href={canonicalUrl} />
        <title>{fullTitle}</title>

        <!-- Favicons -->
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="apple-touch-icon" href="/favicon.svg" />

        <link
            rel="alternate"
            type="application/rss+xml"
            title="Simon Hartcher's Blog RSS Feed"
            href="/rss.xml"
        />
        <script defer src="/main.min.js"></script>
        <PostHog />
        <Turnstile />
    </head>
    <body>
        <div x-data="{ open: false }">
            <form
                method="post"
                action="https://listmonk.simonhartcher.com/subscription/form"
                class="listmonk-form"
            >
                <dialog :open="open">
                    <article>
                        <header>
                            <button
                                aria-label="Close"
                                rel="prev"
                                @click="open = false"></button>
                            <h3>
                                Subscribe for more content delivered to your
                                inbox! ðŸŽ‰
                            </h3>
                        </header>
                        <input type="hidden" name="nonce" />
                        <p>
                            <input
                                type="email"
                                name="email"
                                required
                                placeholder="E-mail"
                            />
                        </p>
                        <p>
                            <input
                                type="text"
                                name="name"
                                placeholder="Name (optional)"
                            />
                        </p>
                        <input
                            id="261b8"
                            type="hidden"
                            name="l"
                            value="261b8248-9c4e-4ab5-a843-d95fab76fee3"
                        />
                        <footer>
                            <altcha-widget
                                challengeurl="https://listmonk.simonhartcher.com/api/public/captcha/altcha"
                            ></altcha-widget>

                            <button
                                type="submit"
                                style="margin-bottom: 0; margin-top: 16px"
                                >Subscribe</button
                            >
                        </footer>
                    </article>
                </dialog>
            </form>
            <NavBar class="nav__horizontal" siteTitle={siteTitle} />
            <aside class="nav__vertical" x-data="{ mobileMenuOpen: false }">
                <NavBar class="nav__vertical" siteTitle={siteTitle} />
            </aside>
        </div>
        <main id="content" class="container">
            <slot />
        </main>
        <script
            async
            src="https://www.googletagmanager.com/gtag/js?id=G-M5R396MEP8"
        ></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag("js", new Date());
            gtag("config", "G-M5R396MEP8");
        </script>
    </body>
</html>
